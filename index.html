<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ó–≤—ñ—Ç –∞–≥–µ–Ω—Ç—ñ–≤ ATF</title>
<style>
  body { background-color: #121212; color: #f5f5f5; font-family: Arial, sans-serif; margin:0; padding:0; }
  header { background-color: #1f1f1f; text-align: center; padding: 20px 0; }
  header img { height: 100px; margin-bottom: 10px; }
  header h1 { margin: 0; font-size: 24px; color: #f5f5f5; }
  form { max-width: 800px; margin: 30px auto; background-color: #1a1a1a; padding: 20px; border-radius: 12px; box-shadow: 0 0 10px #000; }
  label { display: block; margin: 15px 0 5px; }
  input, textarea { width: 100%; padding: 10px; border-radius: 6px; border: none; background-color: #2a2a2a; color: #f5f5f5; }
  textarea { resize: vertical; }
  .link-field { font-size: 12px; color: #aaa; margin-bottom: 10px; }
  button { margin-top: 10px; padding: 10px; border: none; border-radius: 6px; background-color: #007acc; color: #fff; font-size: 14px; cursor: pointer; }
  button:hover { background-color: #005fa3; }
  #totalPoints { margin-top: 15px; font-size: 18px; text-align: center; color: #00ff00; }
  .patrol-entry { margin-bottom: 10px; border: 1px solid #333; padding: 10px; border-radius: 6px; position: relative; }
  .removePatrol { position: absolute; top: 5px; right: 5px; background-color: #cc0000; color: #fff; font-weight: bold; cursor: pointer; border: none; border-radius: 4px; padding: 2px 6px; }
  .invalid { border: 2px solid red; }
</style>
</head>
<body>

<header>
  <img src="https://i.imgur.com/wUCENWM.png" alt="–õ–æ–≥–æ—Ç–∏–ø ATF/FIB">
  <h1>–ó–≤—ñ—Ç –∞–≥–µ–Ω—Ç—ñ–≤ ATF</h1>
</header>

<form id="reportForm">
  <label>Nick Name | –°—Ç–∞—Ç–∏—á–Ω–∏–π ID</label>
  <input type="text" id="agentNick" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: Nick123 | 45678" required>

  <label>‚öñÔ∏è –ö—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞—Ç—Ä–∏–º–∞–Ω—å</label>
  <input type="number" id="arrests" min="0" value="0" required>
  <div class="link-field">–ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Å–∫—Ä—ñ–Ω–∏: <input type="url" id="arrestsLink" placeholder="https://"></div>

  <label>üöî –ü–∞—Ç—Ä—É–ª—ñ</label>
  <div id="patrolsContainer"></div>
  <button type="button" id="addPatrol">–î–æ–¥–∞—Ç–∏ –ø–∞—Ç—Ä—É–ª—å</button>

  <label>üí™ –ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ç—Ä–µ–Ω—É–≤–∞–Ω—å</label>
  <input type="number" id="trainings" min="0" value="0">
  <div class="link-field">–ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Å–∫—Ä—ñ–Ω–∏: <input type="url" id="trainingsLink" placeholder="https://"></div>

  <label>üî´ –£—á–∞—Å—Ç—å –≤ —Å–ø–µ—Ü. –æ–ø–µ—Ä–∞—Ü—ñ—è—Ö</label>
  <input type="number" id="specialOps" min="0" value="0">
  <div class="link-field">–ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Å–∫—Ä—ñ–Ω–∏: <input type="url" id="specialOpsLink" placeholder="https://"></div>

  <label>üéØ –£—á–∞—Å—Ç—å —É –∑–∞—Ö–æ–¥–∞—Ö (–í–ó–•, –ì–†–ü...)</label>
  <input type="number" id="events" min="0" value="0">
  <div class="link-field">–ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Å–∫—Ä—ñ–Ω–∏: <input type="url" id="eventsLink" placeholder="https://"></div>

  <label>üìù –î–æ–¥–∞—Ç–∫–æ–≤–æ</label>
  <textarea id="additional" rows="3"></textarea>

  <div id="totalPoints">–ó–∞–≥–∞–ª—å–Ω—ñ –±–∞–ª–∏: 0</div>

  <button type="submit">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –∑–≤—ñ—Ç</button>
</form>

<script>
const webhookURL = "https://discord.com/api/webhooks/1433882975816257698/cllTSVZt5b0eBh7tpcgGLAYqen7EEvT4K-VVsN63lhkeYaoKdzAHIdagrzb4C-nQIz9S"; // –≤—Å—Ç–∞–≤ —Å–≤—ñ–π Discord Webhook
const jsonBinURL = "https://api.jsonbin.io/v3/b/6903a29aae596e708f385dea"; // –≤—Å—Ç–∞–≤ —Å–≤—ñ–π Google Web App URL
let patrolCount = 0;

const patrolsContainer = document.getElementById("patrolsContainer");
const addPatrolBtn = document.getElementById("addPatrol");

function addPatrol() {
    patrolCount++;
    const div = document.createElement("div");
    div.className = "patrol-entry";
    div.innerHTML = `
        <button type="button" class="removePatrol">‚ùå</button>
        <label>–ü–∞—Ç—Ä—É–ª—å ‚Ññ${patrolCount}</label>
        –ß–∞—Å –ø–æ—á–∞—Ç–∫—É: <input type="time" class="startTime" required>
        –ß–∞—Å –∑–∞–∫—ñ–Ω—á–µ–Ω–Ω—è: <input type="time" class="endTime" required>
        <div class="link-field">–ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Å–∫—Ä—ñ–Ω–∏: <input type="url" class="patrolLink" placeholder="https://"></div>
    `;
    patrolsContainer.appendChild(div);
    div.querySelector(".removePatrol").addEventListener("click", () => {
        div.remove();
        calculatePoints();
    });
}

addPatrolBtn.addEventListener("click", addPatrol);
addPatrol(); // –ø–µ—Ä—à–∏–π –ø–∞—Ç—Ä—É–ª—å

function calculatePoints() {
    let points = 0;
    points += Number(document.getElementById("arrests").value) * 5;
    points += Number(document.getElementById("trainings").value) * 5;
    points += Number(document.getElementById("specialOps").value) * 10;
    points += Number(document.getElementById("events").value) * 10;

    const patrolEntries = document.querySelectorAll(".patrol-entry");
    patrolEntries.forEach(entry => {
        const start = entry.querySelector(".startTime").value;
        const end = entry.querySelector(".endTime").value;
        entry.querySelector(".startTime").classList.remove("invalid");
        entry.querySelector(".endTime").classList.remove("invalid");
        if(start && end){
            const [sh, sm] = start.split(":").map(Number);
            const [eh, em] = end.split(":").map(Number);
            let duration = (eh*60 + em) - (sh*60 + sm);
            if(duration > 0){
                points += Math.floor(duration/30)*2;
            } else {
                entry.querySelector(".startTime").classList.add("invalid");
                entry.querySelector(".endTime").classList.add("invalid");
            }
        }
    });

    document.getElementById("totalPoints").innerText = "–ó–∞–≥–∞–ª—å–Ω—ñ –±–∞–ª–∏: " + points;
    return points;
}

document.getElementById("reportForm").addEventListener("input", calculatePoints);

// –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –∑–≤—ñ—Ç—É –≤ JSONBin
function sendToJsonBin(reportData){
  fetch(jsonBinURL, {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify(reportData)
  })
  .then(res => res.json())
  .then(data => console.log("‚úÖ –ó–≤—ñ—Ç –∑–±–µ—Ä–µ–∂–µ–Ω–æ —É JSONBin:", data))
  .catch(err => console.error("‚ùå –ü–æ–º–∏–ª–∫–∞ JSONBin:", err));
}


// –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –Ω–∞ Discord —ñ Google Sheets
document.getElementById("reportForm").addEventListener("submit", function(e){
    e.preventDefault();
    const totalPoints = calculatePoints();

    const patrolEntries = document.querySelectorAll(".patrol-entry");
    let patrolsText = "";
    patrolEntries.forEach((entry,i)=>{
        const start = entry.querySelector(".startTime").value;
        const end = entry.querySelector(".endTime").value;
        const link = entry.querySelector(".patrolLink").value;
        patrolsText += `–ü–∞—Ç—Ä—É–ª—å ‚Ññ${i+1}: ${start}-${end} (–ü–æ—Å–∏–ª–∞–Ω–Ω—è: ${link})\n`;
    });

    const reportData = {
        username: "–ó–≤—ñ—Ç",
        embeds:[{
            title:"–ó–≤—ñ—Ç –∞–≥–µ–Ω—Ç—ñ–≤ ATF",
            color:3447003,
            fields:[
                {name:"Nick | ID", value:document.getElementById("agentNick").value || "Nick | Statick", inline:true},
                {name:"–ö—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞—Ç—Ä–∏–º–∞–Ω—å", value:document.getElementById("arrests").value + " (–ü–æ—Å–∏–ª–∞–Ω–Ω—è: " + document.getElementById("arrestsLink").value + ")", inline:true},
                {name:"–ü–∞—Ç—Ä—É–ª—ñ", value:patrolsText || "–ù–µ–º–∞—î", inline:true},
                {name:"–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ç—Ä–µ–Ω—É–≤–∞–Ω—å", value:document.getElementById("trainings").value + " (–ü–æ—Å–∏–ª–∞–Ω–Ω—è: " + document.getElementById("trainingsLink").value + ")", inline:true},
                {name:"–£—á–∞—Å—Ç—å –≤ —Å–ø–µ—Ü. –æ–ø–µ—Ä–∞—Ü—ñ—è—Ö", value:document.getElementById("specialOps").value + " (–ü–æ—Å–∏–ª–∞–Ω–Ω—è: " + document.getElementById("specialOpsLink").value + ")", inline:true},
                {name:"–£—á–∞—Å—Ç—å —É –∑–∞—Ö–æ–¥–∞—Ö", value:document.getElementById("events").value + " (–ü–æ—Å–∏–ª–∞–Ω–Ω—è: " + document.getElementById("eventsLink").value + ")", inline:true},
                {name:"–î–æ–¥–∞—Ç–∫–æ–≤–æ", value:document.getElementById("additional").value},
                {name:"–ó–∞–≥–∞–ª—å–Ω—ñ –±–∞–ª–∏", value:totalPoints.toString()}
            ],
            timestamp:new Date().toISOString()
        }]
    };

    // –í—ñ–¥–ø—Ä–∞–≤–∫–∞
    fetch(webhookURL,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify(reportData)
    }).then(resp=>{
        if(resp.ok) alert("–ó–≤—ñ—Ç —É—Å–ø—ñ—à–Ω–æ –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ!");
        else alert("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤—Ü—ñ Discord.");
    }).catch(err=>alert("–ü–æ–º–∏–ª–∫–∞ Discord: "+err));

    // Google Sheets
    const gsData = {
        nick: document.getElementById("agentNick").value,
        arrests: Number(document.getElementById("arrests").value),
        patrols: Array.from(document.querySelectorAll(".patrol-entry")).map(e=>({
            start:e.querySelector(".startTime").value,
            end:e.querySelector(".endTime").value,
            link:e.querySelector(".patrolLink").value
        })),
        trainings: Number(document.getElementById("trainings").value),
        specialOps: Number(document.getElementById("specialOps").value),
        events: Number(document.getElementById("events").value),
        additional: document.getElementById("additional").value,
        totalPoints: totalPoints,
        date: new Date().toISOString()
    };
    sendToJsonBin(gsData);

    // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º–∏
    document.getElementById("reportForm").reset();
    patrolsContainer.innerHTML = "";
    patrolCount = 0;
    addPatrol();
    calculatePoints();
});
</script>

</body>
</html>




